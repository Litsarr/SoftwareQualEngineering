<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script type="module" src="../scripts/logout.js"></script>
    <script type="module" src="../scripts/orders.js"></script>
    <script type="module" src="../scripts/products.js"></script>
    <script type="module" src="../scripts/api.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        /* Header Styles */
        .header {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            margin: 0;
        }
        .logout-btn {
            background-color: #ff4d4d;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .logout-btn:hover {
            background-color: #e60000;
        }

        .dashboard-container {
            width: 80%;
            margin: 50px auto;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        .tabs {
            display: flex;
            justify-content: center;
            border-bottom: 2px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 5px 5px 0 0;
            margin-right: 10px;
        }
        .tab.active {
            background-color: #007bff;
            color: white;
        }
        .order-block {
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
            padding: 15px;
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: normal;
        }
        .crud-btns {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .crud-btns button {
            padding: 5px 10px;
            cursor: pointer;
        }
        .crud-btns button.add-btn {
            background-color: #28a745;
            color: white;
        }
        .crud-btns button.edit-btn {
            background-color: #28a745;
            color: white;
        }
        .crud-btns button.delete-btn {
            background-color: #ff4d4d;
            color: white;
        }
        .items-table {
            width: 100%;
            border-collapse: collapse;
        }
        .items-table th, .items-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .items-table th {
            background-color: #007bff;
            color: white;
        }
        .items-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .item-details {
            margin-top: 10px;
            font-size: 0.9em;
            color: #555;
        }
        /* Inventory Form Styles */
        #add-item-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group input, .form-group textarea {
            padding: 8px;
            font-size: 1em;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: 100%;
            box-sizing: border-box;
        }
        .form-group label {
            font-weight: bold;
        }
        #sizes-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .size-block {
            display: flex;
            gap: 10px;
        }
        .size-block input {
            flex: 1;
        }
        .size-block .stock-input {
            width: 100px;
        }
        .size-block button {
            cursor: pointer;
            padding: 5px 10px;
            font-size: 1.1em;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
        }
        .size-block button:hover {
            background-color: #218838;
        }
        button[type="submit"] {
            background-color: #007bff;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button[type="submit"]:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <div class="header">
        <h1>Islander Administrator</h1>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <div class="dashboard-container">
        <h1>Order History</h1>
        <div class="tabs">
            <div class="tab active" id="all-orders-tab">All Orders</div>
            <div class="tab" id="completed-orders-tab">Completed Orders</div>
            <div class="tab" id="add-item-tab">Add a New Item</div>
            <div class="tab" id="existing-items-tab">Existing Items</div>
        </div>

        <div id="all-orders" class="tab-content active">
            <!-- All Orders Section will be populated dynamically -->
        </div>

        <div id="completed-orders" class="tab-content">
            <!-- Completed Orders Section -->
        </div>

        <div id="add-item" class="tab-content">
            <h1>Add a New Item</h1>
            <form id="add-item-form">
                <div class="form-group">
                    <label for="name">Name:</label>
                    <input type="text" id="name" name="name" required>
                </div>
        
                <div class="form-group">
                    <label for="description">Description:</label>
                    <textarea id="description" name="description" required></textarea>
                </div>
        
                <div class="form-group">
                    <label for="price">Price:</label>
                    <input type="number" id="price" name="price" step="0.01" required>
                </div>
        
                <div class="form-group">
                    <label for="ImageTop">Top Image:</label>
                    <input type="url" id="ImageTop" name="ImageTop" required>
                </div>
        
                <div class="form-group">
                    <label for="ImageSide">Side Image:</label>
                    <input type="url" id="ImageSide" name="ImageSide" required>
                </div>
        
                <!-- Category Dropdown -->
                <div class="form-group">
                    <label for="category">Category:</label>
                    <select id="category" name="category" required>
                        <option value="1">Category 1</option>
                        <option value="2">Category 2</option>
                        <option value="3">Category 3</option>
                        <option value="4">Category 4</option>
                    </select>
                </div>
        
                <div class="form-group" id="sizes-container">
                    <label>Sizes:</label>
                    <div class="size-block">
                        <input type="text" name="sizes[]" placeholder="Size" required>
                        <input type="number" name="stock[]" class="stock-input" placeholder="Stock" required>
                    </div>
                    <button type="button" onclick="addSize()">Add Size</button>
                </div>
        
                <button type="submit">Add Item</button>
            </form>
        </div>
        

        <div id="existing-items" class="tab-content">
            <h1>Existing Items</h1>
            <table class="items-table" id="items-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Price</th>
                        <th>Sizes</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Existing items will appear here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Form submission functionality with confirmation message
        document.getElementById('add-item-form').addEventListener('submit', function(e) {
            e.preventDefault();
    
            // Ask for confirmation before adding the item
            const confirmation = window.confirm("Are you sure you want to add this new item?");
            if (!confirmation) {
                return; 
            }
    
            // Get form data
            const name = document.getElementById('name').value;
            const description = document.getElementById('description').value;
            const price = document.getElementById('price').value;
            const sizes = document.querySelectorAll('input[name="sizes[]"]');
            const stock = document.querySelectorAll('input[name="stock[]"]');
            
            const sizeData = [];
            for (let i = 0; i < sizes.length; i++) {
                sizeData.push({
                    size: sizes[i].value,
                    stock: stock[i].value
                });
            }
    
            // Adding the new item to the "Existing Items" section
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>${name}</td>
                <td>${description}</td>
                <td>${price}</td>
                <td>
                    <ul>
                        ${sizeData.map(item => `<li>${item.size}: ${item.stock} in stock</li>`).join('')}
                    </ul>
                </td>
                <td>
                    <button class="edit-btn" onclick="editItem(this)">Edit</button>
                    <button class="delete-btn" onclick="deleteItem(this)">Delete</button>
                </td>
            `;
            document.querySelector('#items-table tbody').appendChild(newRow);
    
            // Reset form
            this.reset();
        });
    
        // Function to add new size fields
        function addSize() {
            const sizeContainer = document.getElementById('sizes-container');
            const newSizeBlock = document.createElement('div');
            newSizeBlock.classList.add('size-block');
            newSizeBlock.innerHTML = `
                <input type="text" name="sizes[]" placeholder="Size" required>
                <input type="number" name="stock[]" class="stock-input" placeholder="Stock" required>
            `;
            sizeContainer.appendChild(newSizeBlock);
        }
    
        function editItem(button) {
            const row = button.closest('tr'); // Find the closest table row
            const cells = row.querySelectorAll('td'); // Get all the cells of the row

            // Get the current values from the row
            const name = cells[0].textContent;
            const description = cells[1].textContent;
            const price = cells[2].textContent;
            const sizes = cells[3].querySelectorAll('li'); // Get the list of sizes
            const stock = Array.from(sizes).map(size => size.textContent.split(":")[1].trim()); // Get stock from each size

            // Store the original values in case the user cancels the edit
            cells[0].dataset.originalValue = name;
            cells[1].dataset.originalValue = description;
            cells[2].dataset.originalValue = price;
            cells[3].dataset.originalValue = JSON.stringify(stock);

            // Ask for confirmation before editing
            const confirmation = window.confirm(`Are you sure you want to edit this item?`);

            if (confirmation) {
                // Replace the row contents with input fields for editing
                cells[0].innerHTML = `<input type="text" value="${name}" class="edit-input" />`;
                cells[1].innerHTML = `<input type="text" value="${description}" class="edit-input" />`;
                cells[2].innerHTML = `<input type="number" value="${price}" class="edit-input" />`;

                // Create input fields for sizes and stock
                const sizeInputs = Array.from(sizes).map((size, index) => {
                    const sizeValue = size.textContent.split(":")[0].trim();
                    return `
                        <input type="text" value="${sizeValue}" class="edit-size" /> 
                        <input type="number" value="${stock[index]}" class="edit-stock" />
                    `;
                }).join('<br />');

                cells[3].innerHTML = sizeInputs;

                // Replace action buttons with Save and Cancel buttons
                cells[4].innerHTML = `
                    <button class="save-btn" onclick="saveItem(this)">Save</button>
                    <button class="cancel-btn" onclick="cancelEdit(this)">Cancel</button>
                `;
            }
        }


        function saveItem(button) {
        const row = button.closest('tr');
        const cells = row.querySelectorAll('td');
        
        // Get the updated values from the input fields
        const name = cells[0].querySelector('input').value;
        const description = cells[1].querySelector('input').value;
        const price = cells[2].querySelector('input').value;
        const sizes = Array.from(cells[3].querySelectorAll('input.edit-size')).map(input => input.value);
        const stock = Array.from(cells[3].querySelectorAll('input.edit-stock')).map(input => input.value);

        // Update the table with the new values
        cells[0].textContent = name;
        cells[1].textContent = description;
        cells[2].textContent = price;
        cells[3].innerHTML = sizes.map((size, index) => `<li>${size}: ${stock[index]} in stock</li>`).join('');

        // Replace Save and Cancel buttons with Edit and Delete buttons
        cells[4].innerHTML = `
            <button class="edit-btn" onclick="editItem(this)">Edit</button>
            <button class="delete-btn" onclick="deleteItem(this)">Delete</button>
        `;
    }



    function cancelEdit(button) {
        const row = button.closest('tr');
        const cells = row.querySelectorAll('td');

        // Restore original values from dataset
        const originalName = cells[0].dataset.originalValue;
        const originalDescription = cells[1].dataset.originalValue;
        const originalPrice = cells[2].dataset.originalValue;
        const originalStock = JSON.parse(cells[3].dataset.originalValue); // Parse stock data

        // Reset the row to its original state
        cells[0].textContent = originalName;
        cells[1].textContent = originalDescription;
        cells[2].textContent = originalPrice;
        cells[3].innerHTML = originalStock.map(stock => `<li>${stock}: in stock</li>`).join('');

        // Replace Save and Cancel buttons with Edit and Delete buttons
        cells[4].innerHTML = `
            <button class="edit-btn" onclick="editItem(this)">Edit</button>
            <button class="delete-btn" onclick="deleteItem(this)">Delete</button>
        `;
    }
        // Delete item function with confirmation
        function deleteItem(button) {
            const confirmation = window.confirm("Are you sure you want to delete this item?");
            if (confirmation) {
                const row = button.closest('tr');
                row.remove();
            }
        }
    </script>    
</body>
</html>
